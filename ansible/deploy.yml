- name: Deploy Inventory Application
  hosts: app
  connection: aws_ssm       
  gather_facts: true 
  vars:
    ansible_aws_ssm_region: us-east-1
  become: true

  tasks:
    - name: Ensure docker running
      service:
        name: docker
        state: started
        enabled: yes

    - name: Create app directory
      file:
        path: /home/ec2-user/app
        state: directory
        owner: ec2-user
        group: ec2-user

    - name: Copy compose file
      copy:
        src: files/docker-compose.yml
        dest: /home/ec2-user/app/docker-compose.yml

    - name: Copy nginx config
      copy:
        src: files/nginx.conf
        dest: /home/ec2-user/app/nginx.conf

    - name: Run containers
      shell: |
        docker compose pull
        docker compose up -d --remove-orphans
      args:
        chdir: /home/ec2-user/app
