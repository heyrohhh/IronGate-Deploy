name: inventory system- last project

on:
  push:
  branches:
   - main
jobs:
   build-and-push:
        runs-on: ubuntu-latest
        steps: 
           - name: code checkout
           - uses: actions/checkout@v4
           - name: Setup Node.js
             uses: actions/setup-node@v4
             with: 
                node-version: 20
                cache: 'npm'
                cache-dependency-path: ./client/package-lock.json
           - name: Install & Audit
             working-directory: ./client
             run: |
                  npm ci 
                  npm audit --audit-level=moderate --force # Audit fail na kare isliye force
           - name: docker-login
             uses: docker/login-action@v3
             with:
               username: ${{secrets.DOCKERHUB_USERNAME}}
               password: ${{secrets.DOCKERHUB_PASSWORD}}
           - name: Backend docker image build and push
             uses: docker/build-push-action@v4
             with:
                context: ./server/
                push: true
                tags: heyrohhh/iniback:v1
           - name: Frontend docker image build and push
             uses: docker/build-push-action@v4
             with:
                context: ./server/
                push: true
                tags: heyrohhh/infront:v1:v1
   Deploy:
     needs: build-and-push
     runs-on: ubuntu-latest
     steps: 
      - name: Deploy on ec2
        uses: appleboy/ssh-action@master
        with:
         

         

               
